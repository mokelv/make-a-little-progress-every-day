# 黑群晖NAS搭建兰空图床（Lsky）
## 前言
真的是空了好长一段时间才来更新自己的博客了hh。前段时间自己入了 NAS 的坑，看了好多关于 NAS 的博客文章和教程，自己也花了不到 800 搭建了自己的第一台 NAS 哈哈，又在多多上花了 800 多买了两块 4T 紫盘，终于开启了自己的 NAS 捣鼓之旅~~

补充一下哈哈，NAS 可以当作自己的私有存储空间，类似于百度网盘一样，但区别是百度网盘是第三方服务，存储空间都是人家的，而我们的 NAS 也就是一台小型电脑，但存储空间可以自己掌握，比如说我买了两块 4T 的机械硬盘，就相当于我有 8T 的存储空间，同时，又因为 NAS 类似于一个小型电脑，我们可以在上面部署自己的服务，如把自己的个人博客搭建在上面，把自己的图床放在上面等等~~

NAS 最吸引我的一点就是自己的数据自己掌握，自己的数据都放在自己的机械硬盘里，并且将硬盘组成一个 RAID 阵列，这个阵列可以把它当成一个数据保护措施，比如两块硬盘可以组一个 RAID1 阵列，当有一块硬盘由于未知原因损坏的时候，只要把坏的硬盘取下来，换上一个好的硬盘，数据就会自动进行恢复，最大程度上避免了数据丢失。与 RAID1 阵列类似的还有 RAID5 和 RAID10 阵列，它们的区别就是硬盘的可用空间不同~感兴趣的可以自己去查阅相关资料呀~~

哈哈，现在自己在 NAS 的收获上真的很多，目前已经在 NAS 上完成了个人导航页、个人网盘、以及相册的部署~~

后续等这篇博客的图床在 NAS 搭建好以后，就可以把自己的个人博客也迁移到 NAS 上了~~

哦哦还有一个忘了说，NAS 还有一个很棒的功能就是自动备份手机的照片，当配置好以后，我们换手机就再也不用担心照片的问题了，也不用第三方的手机照片备份服务了，真的是又贵空间又小~

欢迎大家访问我的个人导航页~~ [阿宇的导航页](https://aayu.today)

## 环境
* 处理器：J3455-itx
* 群晖系统：DSM 6.2.3-25426 Upload 3
* 产品型号：DS3617xs
* 存储空间：两块 4T 紫盘组 RAID1 阵列

## 安装教程
### 搭建宝塔面板
首先在群晖的 docker 应用里面搜索 baota，选择 `pch18/baota` 这个镜像，双击下载最新的 latest 版本的镜像

![](http://image.aayu.today/2022/01/12/e7789a2be6329.png)

下载好以后可以在镜像列表中看到，如下图，可以看到该容器的大小是真不小啊，占了 5GB 大小的空间

![](http://image.aayu.today/2022/01/12/3d21f3bf28d50.png)

选中该镜像，点击上方的启动，点击高级配置，设置存储空间映射如下图所示

![](http://image.aayu.today/2022/01/12/6920258f5c87b.png)

端口设置如下图所示

![](http://image.aayu.today/2022/01/12/2715710220830.png)

设置完成后，点击确定，等待稍微一段时间后，弹出命令创建失败，这时候别慌。我们可以用 ssh 连接到 NAS 里面，输入 `docker ps`，发现宝塔容器确实没有起来，再次敲击 `docker ps -a` 可以查看所以运行过的容器，发现宝塔容器的状态是 `Created`，如下图

![](http://image.aayu.today/2022/01/12/85c42971f05d3.png)

所以只需要用 `docker start 宝塔容器ID`，启动容器即可。容器启动以后，再次用 `docker ps` 命令，就可以看到已经成功启动的宝塔容器了~~

![](http://image.aayu.today/2022/01/12/3e1abcce3b028.png)

启动完成以后，在浏览器中输入 `ip:18888`，可以看到成功进入宝塔的登陆界面啦，但用户名和密码我们需要通过重置才能获取到

在 NAS 后台管理界面，打开 docker 应用，可以看到我们的宝塔容器也确实启动成功了

![](http://image.aayu.today/2022/01/12/2f0547340adf7.png)

我们还是用 ssh 连接 NAS 系统，然后用 `docker exec -it 宝塔容器ID /bin/bash` 进入容器内部系统，然后输入 `bt` 即可对用户名和密码进行重置，如下图

![](http://image.aayu.today/2022/01/12/5c0a8442abf54.png)

重置完用户名和密码后，在容器内部按 `Ctrl + P + Q` 即可在容器继续运行的情况下安全退出容器~

用新用户名和密码，即可成功登录宝塔面板啦~

### 安装兰空图床
首先进入主页面，点击 PHP-7.3，如下图

![](http://image.aayu.today/2022/01/12/1ebfe72982cc2.png)

然后在安装扩展这里点击 fileinfo 扩展安装（因为我已经装过了，所以这里显示的是卸载）

![](http://image.aayu.today/2022/01/12/ea3ab0f0c4f47.png)

安装完成以后，点击网站，开始新建站点，配置如下图，注意在 IP 后面配置一个可以访问的端口，默认的 80 端口应该是使用不了的

![](http://image.aayu.today/2022/01/12/0af4c3de78a55.png)

然后在兰空图床的 GitHub 官网上下载最新的发行包，并上传到站点的根目录，然后解压，解压完成之后记得把解压之后的文件放在站点的根目录，如下图

![](http://image.aayu.today/2022/01/12/b4b042cd16722.png)

接下来点击站点名称，可以进行网站设置，如下图

![](http://image.aayu.today/2022/01/12/6e4d58cbf32b4.png)

在网站目录下，设置运行目录为 `/public`，点击保存，如下图

![](http://image.aayu.today/2022/01/12/4553770b23267.png)

根据兰空图床[官网教程](https://www.kancloud.cn/wispx/lsky-pro/880044)，nginx 需要设置伪静态，代码如下

```
location / {
    if (!-e $request_filename) {
    	rewrite ^(.*)$ /index.php?s=$1 last; break;
    }
}
```

设置如下图

![](http://image.aayu.today/2022/01/12/15a3203b8d92d.png)

记得点击保存。这样我们的兰空图床的站点就配置好啦~~

### 初始化访问
在浏览器输入 `ip地址:10003`，后，博主发现了一个问题，访问这个端口失败 emmmm

在博主仔细检查了后发现，我们在最开始设置 docker 端口映射时，忘记映射我们这个 `10003` 端口了，诶呀真是失策

所以接下来的操作就是，在 NAS 后台管理界面，进行 docker 应用，先把宝塔容器暂停运行，然后选择宝塔容器，点击上面的编辑，在端口设置里面添加 `10003` 的端口映射，如下图

![](http://image.aayu.today/2022/01/12/3be66807ee889.png)

设置完之后，再把宝塔容器重新恢复运行，注意哦注意哦，这里我们重新刷新宝塔的访问界面，可以在首页发现 Nginx 服务是停止运行的，这就需要我们手动启动这个服务，这里是一个要注意的小地方

![](http://image.aayu.today/2022/01/12/fb5479c4d1edc.png)

当把以上这些都完成以后，再次在浏览器输入 `ip地址:10003`，终于出现了让人开心的界面，如下图

![](http://image.aayu.today/2022/01/12/44d9065f8e998.png)

我们点击下一步，这里的数据库名，用户名和密码可以在宝塔界面的数据库那里查看，如下图

![](http://image.aayu.today/2022/01/12/c48e9e9c3998a.png)

配置如下图

![](http://image.aayu.today/2022/01/12/e387b7616a750.png)

然后点击下一步，在接下来的界面配置一下管理员的邮箱和密码，如下图

![](http://image.aayu.today/2022/01/12/707ac27baa7af.png)

这样我们的图床就配置好啦，开心ヾ(≧▽≦*)o

我们可以在左侧点击登陆，进入图床后台进行详细查看，如下图

![](http://image.aayu.today/2022/01/12/e62e686015c82.png)

输入刚才设置的用户名和密码，就可以进入到图床后台了。在图床后台可以设置上传图片的大小等等，接下来就开始愉快的使用图床吧~~

后续我就会把我的个人博客也都迁移到我的 NAS 里面，啦啦~~

## 参考链接
* [兰空图床官网教程](https://www.kancloud.cn/wispx/lsky-pro/880044)
* [宝塔面板安装lsky-pro（ 兰空图床） – 一款安装简单、功能强大的图床程序](https://www.daniao.org/10229.html)
* [NAS篇:群晖Docker直接装宝塔面板一键部署建站系统](https://post.smzdm.com/p/alpzxzq0/#comments)



