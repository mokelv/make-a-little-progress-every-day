---
title: 极空间上Docker迁移日记
date: 2022-09-03 22:26:15
categories:
 - [我的NAS捣鼓笔记, 极空间]
tags: 
 - NAS
 - 极空间
---

今天买的固态硬盘终于到了，970 EVO Plus 1T，拿来做高速存储，实话说，Docker升级前我还满忐忑的，因为看说明，Docker 升级会把所有的镜像和容器清空，所以我就连夜写了篇博客（[极空间上常用Docker应用推荐-可玩性+++](https://blog.aayu.today/nas/zspace/20220902/)）把 Docker 容器的配置全部记录下来，把数据库都做了备份，才敢去安装固态硬盘作为高速存储，升级 Docker，结果很舒适，Docker 升级后，镜像的下载速度和容器的启动速度提高太多了，以 kangkang 大佬的宝塔镜像为例，升级前我记得镜像光下载就下载了 10 到 20 分钟左右吧，启动宝塔镜像也要花个十几分钟。在 Docker 升级后，宝塔镜像下载 1 分钟左右就下载好了，容器启动更快，几乎秒启，一两秒就启动了，这波升级真可以~

但目前把文件夹映射到高速存储里好像还存在一些 bug，在容器的环境里不能指定其他用户，只能用 root 用户，否则挂载的文件夹就会找不到。比如我的 gitea 容器，在环境里指定了 git 用户去运行 gitea 程序，容器启动后，如果用 git 用户登录 SSH，是找不到挂载在高速存储里的文件夹，这个问题不知道极空间的开发人员是否有遇到。

捣鼓了一中午，发现把 gitea 程序用 chown 命令设置成 root 用户，然后编辑 app.ini，也指定成 root 用户，虽然 gitea 程序能启动了，之前保存的代码仓库也能访问了，但之前配置成功的 SSH 提交代码就不行了，还是有一堆问题，所以木得办法，只能把 gitea 容器里的文件夹映射再改回去了，不用高速存储了

还有其他问题，就是之前论坛里也有人提到的，nginx 的配置文件映射到高速存储，也是因为权限问题，不行，只能改为不用高速存储了

kangkang 大佬的 mariadb 数据库镜像的文件映射到高速缓存里也会出问题，会导致数据库无法删除，再放回机械硬盘，就能删除不用的数据库了，只能说目前极空间的 Dokcer 还有很多 bug 要修复呀

其他容器还在测试，后续如果发现其他问题再补充~
