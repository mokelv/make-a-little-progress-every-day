---
title: 手拉手教你在极空间Docker宝塔上搭建兰空图床（Lsky）
date: 2022-08-21 23:56:50
categories:
 - [我的NAS捣鼓笔记, 极空间]
tags: 
 - NAS
 - 极空间
 - Lsky
 - PicGo
---

## 前言
世界上什么事最让人安心呢，可能每个人心中都有自己的答案。但我觉得有一件事应该没有人会否认，那就是把数据掌握在自己的手上，最让人安心！

我之前其实已经在黑群晖上实现了兰空图床的搭建，详情可以回顾[黑群晖NAS搭建兰空图床（Lsky）](https://blog.aayu.today/nas/synology/20220111/)，而在用了黑群晖一段时间后，发现有了 NAS 之后是真爽啊~~

而自己搭建的黑群晖由于种种原因并不是很稳定，而自己又是个颜狗，极空间 Z4 好看的外观瞬间就吸引了我，包括对用户极为友好的手机 APP 以及是一个国产品牌，于是便入手了极空间 Z4，也开始了本次的折腾之旅哈哈~~

## 安装Docker宝塔
参考我之前的[折腾笔记](https://blog.aayu.today/nas/synology/20220111/)，首先第一步便是要在 Docker 里面安装宝塔面板，但很可惜的是，之前在黑群晖上安装的宝塔镜像在极空间上还真是用不了，原因大家应该也都知道，由于安全原因，极空间的 Docker 并没有开放 Privilege 权限，所以之前的镜像就用不了了。好在天无绝人之路，偶然发现极空间还有个论坛，这可算是打开了新世界的大门呀，里面的大佬原来早已经踩了很多我们可能会碰到的坑了~~

其中，kangkang 大佬已经给出了在极空间 Z4 上搭建宝塔面板的教程了，详情可以看 [极空间Nas-宝塔面板](https://www.chenweikang.top/?p=1104)，所以安装宝塔的步骤按照大佬的教程一步步走下去就可以啦。但是有一处地方建议更改，就是在【基本设置】中的启动性能限制，建议取消，直接给宝塔最大的性能空间。大佬原教程中的 2 核 2G 我实测后感觉带兰空图床太吃力了，图床的 Web 界面加载跳转要等待 5 秒以上。下面展示下我配置好的容器配置，其中端口 8890-8899 是我为宝塔内的网站预留的应用端口，小伙伴可以根据自己需要自由设置啦~

![](https://image.aayu.today/uploads/2022/08/22/202208220358021.png)

![](https://image.aayu.today/uploads/2022/08/22/202208220359767.png)

![](https://image.aayu.today/uploads/2022/08/22/202208220359208.png)

![](https://image.aayu.today/uploads/2022/08/22/202208220359802.png)

![](https://image.aayu.today/uploads/2022/08/22/202208220359320.png)

## 安装兰空图床
安装好宝塔以后，顺利的话输入 `http://NAS的内网IP:18888/f185ef31/` 应该就能看到宝塔的登录界面啦，那用户名和密码是多少呢，我们可以在 Docker 自带的 SSH 里面用 `bt` 命令重置用户名和密码，如下图

![](https://image.aayu.today/uploads/2022/08/22/202208220400511.png)

进去以后，绑定好自己的手机，然后就可以看到主面板了，接下来我们首先点击已经安装好的 PHP-8.0 软件，如下图

![](https://image.aayu.today/uploads/2022/08/22/202208220400527.png)

然后点击启动，把 PHP-8.0 启起来。接下来点击【安装扩展】，安装以下三个扩展，我已经安装好了，所以是卸载的字样。注意，安装大概要耗费半个小时到一个小时的时间，所以要耐心等待，在此期间喝杯茶吧~~

![](https://image.aayu.today/uploads/2022/08/22/202208220401460.png)

然后点击【禁用函数】，把 `exec、shell_exec、readlink、symlink、putenv、chown` 这六个被禁用的函数删掉，也就是取消禁用。

接下来就是创建网站了，在左侧导航栏点击【网站】，然后点击添加站点，设置如下，其中域名那里根据自己需求配置，也可以随便写一个，不影响。

![](https://image.aayu.today/uploads/2022/08/22/202208220401714.png)

点击提交以后，网站就创建好啦。可以点击网站名，配置一下内网访问的端口，如下

![](https://image.aayu.today/uploads/2022/08/22/202208220402767.png)

然后在浏览器中输入 `http://NAS的内网IP:18891/` 出现如下界面就表示内网访问没问题啦~ 注意我这里是 18891 端口是因为配置 Docker 时我设置了 18891 -> 8891 的端口映射啦，所以访问时要用 18891 端口

![](https://image.aayu.today/uploads/2022/08/22/202208220402517.png)

然后点击网站的根目录可以跳转到【文件】目录下，然后去[兰空图床的 GitHub 仓库](https://github.com/lsky-org/lsky-pro) 下载最新的发行版，但建议和我用的版本保持一致以防接下来的配置出问题，我用的是当前的最新版 v2.1 版本。下载完成后，把压缩包上传到网站目录下，如下图

![](https://image.aayu.today/uploads/2022/08/22/202208220403662.png)

然后在安装包上右键解压，解压也需要耗费几分钟的时间，耐心等待一下吧~

解压完成后就继续配置我们的网站吧~

配置网站的运行目录为 `/public`，并取消防跨站攻击（open_basedir），如下图

![](https://image.aayu.today/uploads/2022/08/22/202208220403077.png)

然后设置伪静态，粘贴如下代码到【伪静态】，如下图
```
location / {
  try_files $uri $uri/ /index.php?$query_string;
}
```

![](https://image.aayu.today/uploads/2022/08/22/202208220403847.png)

还差最后一步，重启 PHP-8.0，如下图，我们的准备工作就完成啦

![](https://image.aayu.today/uploads/2022/08/22/202208220403575.png)

## 运行兰空图床
完成以上准备工作后，直接在浏览器中输入 `http://NAS的内网IP:18891/`，如果看到以下界面，恭喜，我们已经成功了 99% 了

![](https://image.aayu.today/uploads/2022/08/22/202208220404570.png)

点击下一步，配置好我们的数据库名称，数据库用户名和密码，以及管理员的账号和密码。其中数据库的相关信息可以在宝塔中查看，如下图

![](https://image.aayu.today/uploads/2022/08/22/202208220404841.png)

![](https://image.aayu.today/uploads/2022/08/22/202208220404911.png)

配置好后点击立即安装，等待十几秒后，叮咚，出现下面界面，兰空图床安装成功啦

![](https://image.aayu.today/uploads/2022/08/22/202208220404712.png)

上传一张图片测试下吧

![](https://image.aayu.today/uploads/2022/08/22/202208220405172.png)

上传成功~~

![](https://image.aayu.today/uploads/2022/08/22/202208220405203.png)

访问也完成没问题，(o゜▽゜)o☆ BINGO!

## 其他配置
如果熟悉 frp 的小伙伴，就可以用 frp 去做内网穿透，再搭配上自己的域名，就可以实现外网访问啦

其中 frp 的 Docker 使用论坛里也有大佬写好了教程，顶礼膜拜~~

![](https://image.aayu.today/uploads/2022/08/22/202208220405399.png)

在配置好内网穿透后，就可以挂载自己的域名进行访问了，下面是我之前在黑群晖上挂载的域名，满满都是成就感~

![](https://image.aayu.today/uploads/2022/08/22/202208220405259.png)

如果在远端云服务器上用宝塔配置了反向代理并且域名使用了 https 的情况下，程序请求静态资源、生成的链接是 http，就会出现如下界面，样式资源丢失

![](https://image.aayu.today/uploads/2022/08/22/202208220406629.png)

解决办法就是在反向代理的配置文件中添加 `roxy_set_header X-Forwarded-Proto $scheme;`

![](https://image.aayu.today/uploads/2022/08/22/202208220406087.png)

更改完后，再次刷新，看到样式在 HTTPS 下也恢复啦~~

![](https://image.aayu.today/uploads/2022/08/22/202208220406186.png)

后续还可以玩的就是搭配 PicGo 实现写博客时快速截图并上传到我们自己的图床上啦，可以看看我的这篇教程：[兰空图床（Lsky）搭配PicGo客户端进行图片快速上传](https://blog.aayu.today/nas/synology/20220114/)

当然，因为我们用的是 V2 版的兰空图床，所以上面那篇教程里用的 PicGo 的插件就不能用了，我们可以换成 hellodk 大佬开发的 lankong 1.1.3 插件，插件的配置教程可以[看这里](https://github.com/hellodk34/picgo-plugin-lankong)~

配置好如下图。这样就可以用 QQ 自带的 `Ctrl + Alt + A`，来快速截图，然后用设置好的 `Ctrl + Shift + Z` 直接将剪切板里的图片上传到我们的极空间里，简直不要太方便~~

![](https://image.aayu.today/uploads/2022/08/22/202208220411011.png)

实测外网的环境下，一到两秒就可以将剪切板里的图片上传，速度虽说没有之前在黑群晖里的快，但也是可以接受的~

## 尾声
在经过一番折腾后，发现在极空间Docker宝塔上搭建的兰空图床还是界面反应很慢，相比我之前在黑群晖上搭建的界面响应速度要慢了两三倍，极空间还有很长的路要走呀，在此也希望极空间的开发人员能早日完善 Docker，并开放 Privilege 权限，这样可玩性才会越高，也能吸引更多爱折腾的人来玩机~

## 参考链接
* [兰空图床官网教程](https://docs.lsky.pro/docs/free/v2/)
* [兰空图床官方GitHub仓库](https://github.com/lsky-org/lsky-pro)
* [【保姆级教程】兰空图床(Lskypro)的宝塔面板安装教程](https://zhuanlan.zhihu.com/p/539654562)
